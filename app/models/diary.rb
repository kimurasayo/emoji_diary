class Diary < ApplicationRecord
  belongs_to :user

  # å„æ—¥è¨˜ã¯ãŸãã•ã‚“ã®ãƒ–ãƒƒã‚¯ãƒžãƒ¼ã‚¯ã‚’ã‚‚ã¤ã“ã¨ãŒå‡ºæ¥ã‚‹
  has_many :bookmarks, dependent: :destroy

  # æ„Ÿæƒ…ã‚’è¡¨ã™çµµæ–‡å­—ã¯1ã¤å¿…é ˆ
  validates :feeling, presence: true,
                      format: { with: /["ðŸ˜€", "ðŸ˜ƒ", "ðŸ˜„", "ðŸ˜", "ðŸ˜†", "ðŸ˜…", "ðŸ¤£", "ðŸ˜‚", "ðŸ˜‰", "ðŸ˜Š", "ðŸ˜‡", "ðŸ¤—", "ðŸ˜‹", "ðŸ˜", "ðŸ™‚", "ðŸ˜Ž", "ðŸ¤ ", "ðŸ¤©", "ðŸ¥°", "ðŸ˜",
                              "ðŸ˜˜", "ðŸ˜—", "ðŸ˜š", "ðŸ˜™", "ðŸ˜›", "ðŸ˜œ", "ðŸ¤ª", "ðŸ¤‘", "ðŸ¥³", "ðŸ¤¤", "ðŸ˜³", "ðŸ¤“", "ðŸ˜Œ", "ðŸ¥¸", "ðŸ˜²", "ðŸ˜¯", "ðŸ˜®", "ðŸ˜¬", "ðŸ¤­", "ðŸ¤«", "ðŸ¤”", "ðŸ¤", "ðŸ¤¨",
                              "ðŸ§", "ðŸ˜", "ðŸ˜’", "ðŸ™ƒ", "ðŸ™„", "ðŸ¤¥", "ðŸ¥º", "ðŸ¥²", "ðŸ˜ž", "ðŸ˜¥", "ðŸ˜¢", "ðŸ˜­", "ðŸ˜“", "ðŸ˜”", "ðŸ˜£", "ðŸ˜©", "ðŸ˜µ", "ðŸ˜·", "ðŸ¤•", "ðŸ¤¢", "ðŸ¤®", "ðŸ¤§", "ðŸ¥µ",
                              "ðŸ¥¶", "ðŸ¥´", "ðŸ¤’", "ðŸ˜", "ðŸ˜¶", "ðŸ˜‘", "ðŸ˜•", "ðŸ˜Ÿ", "ðŸ™", "ðŸ˜–", "ðŸ˜«", "ðŸ¥±", "ðŸ˜ª", "ðŸ˜´", "ðŸ˜¦", "ðŸ˜§", "ðŸ˜¨", "ðŸ˜°", "ðŸ˜±", "ðŸ¤¯", "ðŸ˜¤", "ðŸ˜¡", "ðŸ˜ ",
                              "ðŸ¤¬", "ðŸ˜ˆ", "ðŸ‘¿"]/,
                                          message: "çµµæ–‡å­—ã ã‘å…¥åŠ›ã§ãã¾ã™" },
                      length: { maximum: 1 }

  # ãƒãƒªãƒ‡ãƒ¼ã‚¿ãƒ¼ã«ã¦ä½¿ç”¨ã§ãã‚‹æ–‡å­—ã‚’å®šç¾©ã—ã¦ã„ã‚‹
  validates :body, emoji: true, length: { maximum: 20 }

  # æ—¥è¨˜ã®æ—¥ä»˜ã¯å¿…é ˆ
  validates :start_time, presence: true

  # validateã«ä¸‹è¨˜ã§å®šç¾©ã—ãŸãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¨­å®š
  validate :start_time_cannot_be_in_the_future

  validates :start_time, uniqueness: { scope: :user }

  # æœ€çµ‚æ›´æ–°æ—¥ã‹ã‚‰30æ—¥åˆ†ã®æ—¥è¨˜ã®æ„Ÿæƒ…ã ã‘ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ã‚¹ã‚³ãƒ¼ãƒ—
  scope :current_month, -> { where(start_time: Time.now - 30.days..Time.now) }

  # ç”Ÿå¹´æœˆæ—¥ã®æœªæ¥æ—¥ã®ãƒã‚§ãƒƒã‚¯ãƒ¡ã‚½ãƒƒãƒ‰
  def start_time_cannot_be_in_the_future
    # æ—¥æ™‚ãŒå…¥åŠ›æ¸ˆã‹ã¤æœªæ¥æ—¥(ç¾åœ¨æ—¥ä»˜ã‚ˆã‚Šæœªæ¥)ãªã‚‰ã°ã€ã‚¨ãƒ©ãƒ¼å¯¾è±¡ã¨ã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¨ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¨­å®š
    errors.add(:start_time, "æœªæ¥ã®æ—¥ä»˜ã¯å…¥åŠ›ã§ãã¾ã›ã‚“") if start_time.present? && start_time > Date.today
  end
end
