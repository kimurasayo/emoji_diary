class User < ApplicationRecord
  # sorceryã®ãƒ¡ã‚½ãƒƒãƒ‰ã€‚Userãƒ¢ãƒ‡ãƒ«ã§å¿…è¦ãªã‚¯ãƒ©ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã¨ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚
  authenticates_with_sorcery!

  # Diaryãƒ¢ãƒ‡ãƒ«ã¨ã®ã‚¢ã‚½ã‚·ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ¶ˆã•ã‚ŒãŸã‚‰æ—¥è¨˜ã‚‚æ¶ˆã™
  has_many :diaries, dependent: :destroy

  # Relationshipãƒ¢ãƒ‡ãƒ«ã¨ã®ã‚¢ã‚½ã‚·ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ¶ˆã•ã‚ŒãŸã‚‰ãƒ•ã‚©ãƒ­ãƒ¼æƒ…å ±ã‚‚æ¶ˆã™
  has_many :relationships, dependent: :destroy
  # following=ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ã„ã‚‹äººã‚’å–å¾—ã™ã‚‹ã€relationshipãƒ¢ãƒ‡ãƒ«ã®followerã‚’å‚ç…§ã™ã‚‹
  has_many :followings, through: :relationships, source: :follower

  # passive_relationshipsã¯åˆ¥åã€‚follower_idã‚’å…¥ã‚Šå£ã«ã—ã¦ã€class_name: 'Relationship'ã‚’ã¤ã‘ã¦å‚ç…§ãƒ¢ãƒ‡ãƒ«ã‚’æŒ‡å®šã€‚
  has_many :passive_relationships, class_name: 'Relationship', foreign_key: 'follower_id', dependent: :destroy
  # Userã¯ãŸãã•ã‚“ã®followersã‚’passive_relationshipsã‚’é€šã˜ã¦æŒã£ã¦ã„ã‚‹ã€‚relationshipã®userã‚’å‚ç…§ã™ã‚‹
  has_many :followers, through: :passive_relationships, source: :user

  # å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãŸãã•ã‚“ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚’ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹
  has_many :bookmarks, dependent: :destroy
  # ãŠæ°—ã«å…¥ã‚Šã«ã—ã¦ã„ã‚‹æ—¥è¨˜ã‚’å–å¾—ã™ã‚‹
  has_many :bookmark_diaries, through: :bookmarks, source: :diary

  # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯åŠè§’è‹±æ•°å­—æ•°å­—ã®ã¿å¯èƒ½ã€‚
  VALID_PASSWORD_REGEX = /\A[a-zA-Z0-9]+\z/

  # if~å†…å®¹å¤‰æ›´æ™‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®å…¥åŠ›ã‚’çœç•¥ã•ã›ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ã€‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®é•·ã•ã¯8æ–‡å­—ä»¥ä¸Šã€‚
  validates :password, length: { minimum: 8 }, format: { with: VALID_PASSWORD_REGEX, message: "åŠè§’è‹±æ•°å­—ã®ã¿ä½¿ç”¨ã§ãã¾ã™" }, if: -> { new_record? || changes[:crypted_password] }
  validates :password, confirmation: true, if: -> { new_record? || changes[:crypted_password] }
  validates :password_confirmation, presence: true, if: -> { new_record? || changes[:crypted_password] }

  # emailã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  # ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã€‚emailã‚’ã‚»ãƒ¼ãƒ–ã™ã‚‹å‰ã«å…¨ã¦å°æ–‡å­—ã«ã™ã‚‹
  before_save { self.email = email.downcase }
  # emailã®å½¢å¼ã«ãªã£ã¦ã„ã¦ã‚‹ç¢ºèªã™ã‚‹ã€‚@ã‚„.ãªã©å¿…é ˆé …ç›®ãŒã‚ã‚‹ã‹ç¢ºèªã™ã‚‹
  VALID_EMAIL_REGEX = /\A[\w+\-.]+@[a-z\d\-.]+\.[a-z]+\z/i
  # emailã¯å¿…é ˆæ¡ä»¶ã€ä¸€æ„ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã¨ãã«å¤§æ–‡å­—å°æ–‡å­—ã®åŒºåˆ¥ã‚’ã—ã¦ã„ã‚‹
  validates :email, {presence: true, format: { with: VALID_EMAIL_REGEX }, uniqueness: { case_sensitive: false }}

  # nicknameã¯å¿…é ˆé …ç›®
  validates :nickname, presence: true

  # nameã¯Twitterã§ã„ã†ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã®ã‚ˆã†ãªã‚‚ã®ã€‚ä¸€æ„ã§å¿…é ˆé …ç›®ã€‚15æ–‡å­—ä»¥å†…ã€‚åŠè§’è‹±æ•°å­—ã®ã¿ã€‚
  validates :name, uniqueness: true, presence: true, length: { maximum: 15 }, format: { with: /\A[a-zA-Z0-9]+\z/, message: "åŠè§’è‹±æ•°å­—ã®ã¿ä½¿ç”¨ã§ãã¾ã™" }

  # ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ç®¡ç†è€…ã€ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼
  enum role: { general: 0, admin: 1 }

  # ã‚µã‚¤ãƒˆã®ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼
  enum color: { pink: 0, blue: 1}

  # ãƒ•ã‚©ãƒ­ãƒ¼ã™ã‚‹
  def follow(other_user)
    # è‡ªåˆ†è‡ªèº«ã¯ãƒ•ã‚©ãƒ­ãƒ¼ã§ããªã„
    return if self == other_user

    relationships.find_or_create_by!(follower: other_user)
  end

  # ãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹
  def following?(user)
    followings.include?(user)
  end

  # ã€€ãƒ•ã‚©ãƒ­ãƒ¼ã‚’ã¯ãšã™
  def unfollow(relathinoship_id)
    relationships.find(relathinoship_id).destroy!
  end

  # ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã™ã‚‹
  def bookmark(diary)
    bookmark_diaries << diary
  end

  # ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚’å¤–ã™
  def unbookmark(diary)
    bookmark_diaries.delete(diary)
  end

  # ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã—ã¦ã„ã‚‹ã‹åˆ¤å®šã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰
  def bookmark?(diary)
    bookmark_diaries.include?(diary)
  end

  # nicknameã«ä½¿ã†ãƒ©ãƒ³ãƒ€ãƒ çµµæ–‡å­—
  def emoji_nickname
    ['ğŸ§â€â™€ï¸', 'ğŸ§', 'ğŸ§â€â™‚ï¸', 'ğŸ§œâ€â™€ï¸', 'ğŸ§šâ€â™€ï¸', 'ğŸ’ƒ', 'ğŸ•º', 'ğŸ§¶', 'ğŸ§µ', 'ğŸª¡', 'ğŸ‘‘', 'ğŸ‘›', 'ğŸ‘’', 'ğŸ¶', 'ğŸ±', 'ğŸ­', 'ğŸ¹', 'ğŸ°', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼', 'ğŸ»', 'ğŸ¨', 'ğŸ¯', 'ğŸ¦', 'ğŸ®', 'ğŸ·',
     'ğŸ¸', 'ğŸµ', 'ğŸ’', 'ğŸ”', 'ğŸ§', 'ğŸ¤', 'ğŸ£', 'ğŸ¥', 'ğŸ¦†', 'ğŸ¦…', 'ğŸ¦‰', 'ğŸ¦‡', 'ğŸº', 'ğŸ—', 'ğŸ´', 'ğŸ¦„', 'ğŸ', 'ğŸ¦‹', 'ğŸŒ', 'ğŸ›', 'ğŸ', 'ğŸœ', 'ğŸ¢', 'ğŸ¦–', 'ğŸ¦•', 'ğŸ™', 'ğŸ¦', 'ğŸ¦€',
     'ğŸ¡', 'ğŸ ', 'ğŸŸ', 'ğŸ¬', 'ğŸ³', 'ğŸ‹', 'ğŸ¦ˆ', 'ğŸ¦­', 'ğŸŠ', 'ğŸ…', 'ğŸ†', 'ğŸ¦“', 'ğŸ¦›', 'ğŸ˜', 'ğŸª', 'ğŸ«', 'ğŸ¦’', 'ğŸ¦˜', 'ğŸ„', 'ğŸ', 'ğŸ–', 'ğŸ', 'ğŸ¦™', 'ğŸ•', 'ğŸ©', 'ğŸ¦Œ', 'ğŸˆ', 'ğŸˆâ€â¬›',
     'ğŸª¶', 'ğŸ“', 'ğŸ¦ƒ', 'ğŸ¦¤', 'ğŸ¦š', 'ğŸ¦œ', 'ğŸ¦¢', 'ğŸ¦©', 'ğŸ•Š', 'ğŸ‡', 'ğŸ¦', 'ğŸ¦¨', 'ğŸ¦¡', 'ğŸ¦«', 'ğŸ¦¦', 'ğŸ¦¥', 'ğŸ', 'ğŸ€', 'ğŸ¿', 'ğŸ¦”', 'ğŸ¾', 'ğŸ‰', 'ğŸŒµ', 'ğŸ„', 'ğŸªµ', 'ğŸŒ´', 'ğŸŒ±', 'ğŸŒ¿',
     'â˜˜ï¸', 'ğŸ€', 'ğŸª´', 'ğŸƒ', 'ğŸ‚', 'ğŸ', 'ğŸ„', 'ğŸš', 'ğŸŒ¾', 'ğŸ’', 'ğŸŒ·', 'ğŸŒ¹', 'ğŸŒº', 'ğŸŒ¸', 'ğŸŒ¼', 'ğŸŒ»', 'ğŸŒ™', 'ğŸŒ', 'ğŸª', 'â­ï¸', 'ğŸ”¥', 'ğŸŒˆ', 'â›„ï¸', 'ğŸ', 'ğŸ', 'ğŸ', 'ğŸŠ', 'ğŸ‹', 'ğŸŒ',
     'ğŸ‰', 'ğŸ‡', 'ğŸ“', 'ğŸˆ', 'ğŸ’', 'ğŸ‘', 'ğŸ¥­', 'ğŸ', 'ğŸ¥¥', 'ğŸ¥', 'ğŸ…', 'ğŸ†', 'ğŸ¥‘', 'ğŸ¥¦', 'ğŸ¥¬', 'ğŸ¥’', 'ğŸŒ¶', 'ğŸ«‘', 'ğŸŒ½', 'ğŸ¥•', 'ğŸ§…', 'ğŸ ', 'ğŸ¥', 'ğŸ¥¯', 'ğŸ', 'ğŸ¥–', 'ğŸ¥¨', 'ğŸ§€', 'ğŸ³',
     'ğŸ¥', 'ğŸ§‡', 'ğŸ¥“', 'ğŸ¥©', 'ğŸ—', 'ğŸ–', 'ğŸ¦´', 'ğŸŒ­', 'ğŸ”', 'ğŸŸ', 'ğŸ•', 'ğŸ¥ª', 'ğŸ¥™', 'ğŸŒ®', 'ğŸŒ¯', 'ğŸ¥—', 'ğŸ¥˜', 'ğŸ¥«', 'ğŸ', 'ğŸœ', 'ğŸ›', 'ğŸ£', 'ğŸ¥Ÿ', 'ğŸ¦ª', 'ğŸ¤', 'ğŸ™', 'ğŸ˜', 'ğŸ¥', 'ğŸ¢',
     'ğŸ¡', 'ğŸ§', 'ğŸ¨', 'ğŸ¦', 'ğŸ¥§', 'ğŸ§', 'ğŸ°', 'ğŸ‚', 'ğŸ®', 'ğŸ­', 'ğŸ¬', 'ğŸ«', 'ğŸ¿', 'ğŸ©', 'ğŸª', 'ğŸŒ°', 'ğŸ¥œ', 'ğŸ¯', 'ğŸ¼', 'ğŸ«–', 'â˜•ï¸', 'ğŸµ', 'ğŸ§ƒ', 'ğŸ¥¤', 'ğŸ§‹', 'ğŸ¶', 'ğŸº', 'ğŸ¥‚', 'ğŸ·',
     'ğŸ¹', 'ğŸ¾', 'âš½ï¸', 'ğŸ€', 'ğŸˆ', 'ğŸ¾', 'ğŸ', 'ğŸ±', 'ğŸ“', 'ğŸ¸', 'ğŸ’', 'ğŸ¥', 'â›³ï¸', 'ğŸª', 'ğŸ¹', 'ğŸ£', 'ğŸ¥Š', 'ğŸ¥‹', 'ğŸ›¹', 'ğŸ›¼', 'ğŸ›·', 'â›¸', 'â›·', 'ğŸ‚', 'ğŸª‚', 'ğŸ‡', 'ğŸ„â€â™‚ï¸', 'ğŸ†', 'ğŸª',
     'ğŸ­', 'ğŸ©°', 'ğŸ¨', 'ğŸ¬', 'ğŸ¤', 'ğŸ§', 'ğŸ¼', 'ğŸ¹', 'ğŸ¥', 'ğŸª˜', 'ğŸ·', 'ğŸº', 'ğŸª—', 'ğŸ¸', 'ğŸª•', 'ğŸ»', 'ğŸ²', 'ğŸ¯', 'ğŸ³', 'ğŸ®', 'ğŸ°', 'ğŸ§©', 'ğŸš—', 'ğŸšŒ', 'ğŸ', 'ğŸš“', 'ğŸš‘', 'ğŸš’', 'ğŸ›´',
     'ğŸš²', 'ğŸ›µ', 'ğŸ', 'ğŸšƒ', 'ğŸš…', 'ğŸš‚', 'ğŸ›«', 'ğŸ›°', 'ğŸš€', 'ğŸ›¸', 'ğŸš', 'ğŸ›¶', 'â›µï¸', 'ğŸ›¥', 'âš“ï¸', 'ğŸ—º', 'ğŸ—¿', 'ğŸ—½', 'ğŸ—¼', 'ğŸ°', 'ğŸ¯', 'ğŸŸ', 'ğŸ¡', 'ğŸ¢', 'ğŸ ', 'â›²ï¸', 'ğŸ–', 'ğŸ', 'ğŸœ',
     'ğŸŒ‹', 'ğŸ•', 'ğŸ—»', 'ğŸ“·', 'ğŸ', 'ğŸ§­', 'â°', 'ğŸ•°', 'â³', 'ğŸ“¡', 'ğŸ”¦', 'ğŸ’¡', 'ğŸª”', 'ğŸ•¯', 'ğŸ’¸', 'ğŸ’', 'ğŸ’£', 'ğŸ§¨', 'ğŸ”®', 'ğŸ”­', 'ğŸ”¬', 'ğŸ§º', 'ğŸ§½', 'ğŸ›', 'ğŸ”‘', 'ğŸ—', 'ğŸª‘', 'ğŸšª', 'ğŸ›‹',
     'ğŸ§¸', 'ğŸª†', 'ğŸ–¼', 'ğŸª', 'ğŸ›', 'ğŸ›’', 'ğŸ', 'ğŸˆ', 'ğŸ', 'ğŸ€', 'ğŸ', 'ğŸ“®', 'ğŸ“š', 'ğŸ”–', 'ğŸ§·', 'ğŸƒ'].sample
  end

  def to_param
    name
  end

  def self.guest
    find_or_create_by!(email: 'guest@example.com') do |user|
      user.password = SecureRandom.hex(10)
      user.password_confirmation = user.password
      user.name = 'guest'
      user.nickname = 'ğŸ”°'
    end
  end

  def self.other_user
    find_or_create_by!(email: 'guest2@example.com') do |user|
      user.password = SecureRandom.hex(10)
      user.password_confirmation = user.password
      user.name = 'guest2'
      user.nickname = 'ğŸ‘'
    end
  end
end
